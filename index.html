<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ğŸ„ è–èª•é»ç‡ˆæŒ‘æˆ°è³½ - åˆ†æ•¸è¶Šé«˜æŠ˜æ‰£è¶Šå¤šï¼</title>
    <style>
        :root {
            --bg-color: #0F2027;
            --primary-red: #D42E2E;
            --primary-green: #2F5D62;
            --gold: #FFD700;
            --text-white: #ffffff;
        }

        body {
            font-family: 'Segoe UI', 'Microsoft JhengHei', sans-serif;
            background: radial-gradient(circle at center, #203A43, #0F2027);
            color: var(--text-white);
            margin: 0;
            height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            overflow: hidden;
            position: relative;
        }

        /* é›ªèŠ±èƒŒæ™¯å‹•ç•« */
        .snow {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 0;
            background-image: url('data:image/svg+xml;utf8,<svg version="1.1" xmlns="http://www.w3.org/2000/svg" width="20" height="20"><circle cx="10" cy="10" r="2" fill="white" opacity="0.3"/></svg>');
            animation: snow-fall 20s linear infinite;
        }

        @keyframes snow-fall {
            from { background-position: 0 0; }
            to { background-position: 0 500px; }
        }

        /* éŠæˆ²å®¹å™¨ */
        .game-container {
            width: 90%;
            max-width: 450px;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 20px;
            box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.37);
            border: 1px solid rgba(255, 255, 255, 0.18);
            z-index: 10;
            text-align: center;
            position: relative;
            transition: height 0.3s ease;
        }

        /* è–èª•æ¨¹è¦–è¦º */
        .tree-wrapper {
            position: relative;
            width: 120px;
            height: 160px;
            margin: 0 auto 20px;
            transition: filter 0.5s ease, transform 0.3s ease;
            filter: brightness(0.4) grayscale(0.8); /* åˆå§‹æš—æ·¡ */
        }
        
        .tree-svg {
            width: 100%;
            height: 100%;
            filter: drop-shadow(0 4px 6px rgba(0,0,0,0.3));
        }

        /* ç‡ˆå…‰ç­‰ç´š */
        .tree-level-1 { filter: brightness(0.7) grayscale(0.5); }
        .tree-level-2 { filter: brightness(0.9) grayscale(0.2); }
        .tree-level-3 { filter: brightness(1.1) grayscale(0) drop-shadow(0 0 10px gold); }
        .tree-level-max { 
            filter: brightness(1.3) saturate(1.2) drop-shadow(0 0 25px gold); 
            animation: glow 1.5s infinite alternate; 
        }

        @keyframes glow {
            from { filter: brightness(1.2) drop-shadow(0 0 15px gold); }
            to { filter: brightness(1.4) drop-shadow(0 0 35px gold); }
        }

        /* ç­”å°æ™‚çš„ç‰¹æ•ˆå‹•ç•« */
        .pulse-animation {
            animation: pulse-tree 0.5s ease-in-out;
        }
        @keyframes pulse-tree {
            0% { transform: scale(1); }
            50% { transform: scale(1.15); filter: brightness(1.5); }
            100% { transform: scale(1); }
        }

        /* ä»‹é¢å…ƒç´  */
        h1, h2 { margin: 10px 0; text-shadow: 0 2px 4px rgba(0,0,0,0.5); }
        
        .btn {
            background: var(--primary-red);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 50px;
            font-size: 1.1rem;
            font-weight: bold;
            cursor: pointer;
            transition: transform 0.2s, background 0.2s;
            width: 80%;
            margin: 15px auto;
            display: block;
            box-shadow: 0 4px 6px rgba(0,0,0,0.2);
        }

        .btn:active { transform: scale(0.95); }
        .btn:hover { background: #ff4747; }
        
        .option-btn {
            background: rgba(255,255,255,0.15);
            border: 1px solid rgba(255,255,255,0.3);
            text-align: left;
            padding: 15px;
            margin: 10px 0;
            width: 100%;
            border-radius: 12px;
            font-size: 1rem;
            color: white;
            transition: all 0.2s;
        }
        .option-btn:hover {
            background: rgba(255,255,255,0.25);
        }

        /* ç‹€æ…‹é¡¯ç¤º */
        .status-bar {
            display: flex;
            justify-content: space-between;
            margin-bottom: 15px;
            font-size: 0.9rem;
            color: #ccc;
            background: rgba(0,0,0,0.2);
            padding: 8px 15px;
            border-radius: 20px;
        }
        .score-display { color: var(--gold); font-weight: bold; font-size: 1.2rem; }

        /* è¨ˆæ™‚æ¢ */
        .timer-bar {
            width: 100%;
            height: 8px;
            background: rgba(255,255,255,0.2);
            border-radius: 4px;
            margin-bottom: 20px;
            overflow: hidden;
        }
        .timer-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--gold), #FFA500);
            width: 100%;
            transition: width 1s linear;
        }

        /* çµæœé æŠ˜æ‰£ç¢¼ */
        .coupon-card {
            background: white;
            color: #333;
            padding: 25px 20px;
            border-radius: 15px;
            margin-top: 25px;
            position: relative;
            overflow: hidden;
            box-shadow: 0 10px 20px rgba(0,0,0,0.3);
            animation: popIn 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
        
        @keyframes popIn {
            from { transform: scale(0.8); opacity: 0; }
            to { transform: scale(1); opacity: 1; }
        }

        .coupon-card::before {
            content: '';
            position: absolute;
            top: 0; left: 0; width: 100%; height: 6px;
            background: linear-gradient(90deg, var(--primary-red), var(--primary-green));
        }
        .discount-code {
            font-size: 2.2rem;
            font-weight: 800;
            color: var(--primary-red);
            border: 2px dashed #ccc;
            padding: 10px;
            margin: 15px 0;
            cursor: pointer;
            background: #f9f9f9;
        }
        .discount-desc { font-size: 0.9rem; color: #666; }

        /* éš±è— */
        .hidden { display: none !important; }

    </style>
</head>
<body>

    <div class="snow"></div>

    <div class="game-container">
        
        <!-- è–èª•æ¨¹ (SVG) -->
        <div class="tree-wrapper" id="treeVisual">
            <svg class="tree-svg" viewBox="0 0 100 130">
                <!-- æ¨¹å¹¹ -->
                <rect x="45" y="110" width="10" height="20" fill="#5D4037" />
                <!-- æ¨¹è‘‰ -->
                <path d="M50 20 L20 60 L80 60 Z" fill="#2E7D32" />
                <path d="M50 40 L15 90 L85 90 Z" fill="#2E7D32" />
                <path d="M50 60 L10 110 L90 110 Z" fill="#388E3C" />
                <!-- æ˜Ÿæ˜Ÿ -->
                <path d="M50 5 L53 15 L63 15 L55 22 L58 32 L50 26 L42 32 L45 22 L37 15 L47 15 Z" fill="#FFD700" />
                <!-- è£é£¾çƒ -->
                <circle cx="30" cy="70" r="3" fill="#D42E2E" />
                <circle cx="70" cy="80" r="3" fill="#FFD700" />
                <circle cx="50" cy="50" r="3" fill="#00CED1" />
                <circle cx="40" cy="100" r="3" fill="#FFA500" />
                <circle cx="60" cy="95" r="3" fill="#FFFFFF" />
            </svg>
        </div>

        <!-- 1. é–‹å§‹ç•«é¢ -->
        <div id="startScreen">
            <h1>ğŸ… è–èª•æ¶åˆ†è³½</h1>
            <p>å›ç­”è¶Šå¿«ï¼Œåˆ†æ•¸è¶Šé«˜ï¼ŒæŠ˜æ‰£è¶Šå¤šï¼</p>
            <div style="font-size: 0.9rem; margin: 25px 0; background: rgba(0,0,0,0.2); padding: 15px; border-radius: 10px;">
                <p style="margin:5px 0">ğŸ† <span style="color:#FFD700">400åˆ†â†‘</span> : <strong>8 æŠ˜</strong> (æœ€é«˜æ¦®è€€)</p>
                <p style="margin:5px 0">ğŸ¥ˆ <span style="color:#C0C0C0">200åˆ†â†‘</span> : <strong>9 æŠ˜</strong> (é«˜æ‰‹èªè­‰)</p>
                <p style="margin:5px 0">ğŸ¥‰ <span style="color:#CD7F32">åƒåŠ ç</span> : <strong>95 æŠ˜</strong> (äººäººæœ‰ç)</p>
            </div>
            <button class="btn" onclick="game.start()">ğŸ”” é–‹å§‹æŒ‘æˆ°</button>
        </div>

        <!-- 2. éŠæˆ²ç•«é¢ -->
        <div id="gameScreen" class="hidden">
            <div class="status-bar">
                <span>é¡Œç›®: <span id="qCount">1/5</span></span>
                <span>å¾—åˆ†: <span id="scoreVal" class="score-display">0</span></span>
            </div>
            <div class="timer-bar"><div class="timer-fill" id="timerBar"></div></div>
            
            <h3 id="questionText" style="min-height: 50px; margin-bottom: 20px;">é¡Œç›®è¼‰å…¥ä¸­...</h3>
            <div id="optionsContainer">
                <!-- é¸é …æŒ‰éˆ• -->
            </div>
        </div>

        <!-- 3. çµç®—ç•«é¢ -->
        <div id="resultScreen" class="hidden">
            <h2>ğŸ‰ æŒ‘æˆ°çµæŸï¼</h2>
            <p>ä½ çš„ç¸½åˆ†æ˜¯ï¼š<span id="finalScore" class="score-display" style="font-size: 2rem;">0</span></p>
            
            <div class="coupon-card">
                <div id="rewardTitle" style="font-size: 1.1rem; font-weight: bold; color: #333;">æ­å–œç²å¾—æŠ˜æ‰£ç¢¼</div>
                <div class="discount-code" id="codeDisplay" onclick="game.copyCode()">Loading...</div>
                <p class="discount-desc">ğŸ‘† é»æ“Šä»£ç¢¼å³å¯è¤‡è£½ï¼Œçµå¸³æ™‚ä½¿ç”¨</p>
            </div>

            <button class="btn" onclick="location.reload()" style="margin-top:25px; background: rgba(255,255,255,0.2);">ğŸ”„ å†ç©ä¸€æ¬¡åˆ·é«˜åˆ†</button>
        </div>

    </div>

    <script>
        // é¡Œåº« (å•é¡Œ, é¸é …, æ­£ç¢ºç­”æ¡ˆç´¢å¼•)
        const RAW_QUESTIONS = [
            { q: "è–èª•è€äººçš„é›ªæ©‡æ˜¯ç”±ä»€éº¼å‹•ç‰©æ‹‰çš„ï¼Ÿ", options: ["å“ˆå£«å¥‡", "é¦´é¹¿", "åŒ—æ¥µç†Š", "è¢‹é¼ "], ans: 1 },
            { q: "å‚³çµ±è–èª•æ¨¹é ‚ç«¯é€šå¸¸æœƒæ”¾ä»€éº¼ï¼Ÿ", options: ["æ˜Ÿæ˜Ÿ", "å—ç“œ", "è¥ªå­", "ç”œç”œåœˆ"], ans: 0 },
            { q: "è–èª•ç¯€æ˜¯ç‚ºäº†æ…¶ç¥èª°çš„èª•ç”Ÿï¼Ÿ", options: ["è–èª•è€äºº", "è€¶ç©Œ", "è¯ç››é “", "éº‹é¹¿é­¯é“å¤«"], ans: 1 },
            { q: "çŸ¥åçš„ç´…é¼»å­é¦´é¹¿å«ä»€éº¼åå­—ï¼Ÿ", options: ["æ¹¯å§†", "å‚‘åˆ©", "é­¯é“å¤«", "å²åŠªæ¯”"], ans: 2 },
            { q: "è–èª•è€äººé€šå¸¸å¾å“ªè£¡é€²å…¥æˆ¿å­é€ç¦®ç‰©ï¼Ÿ", options: ["å¤§é–€", "çª—æˆ¶", "ç…™å›ª", "æ’æ°´ç®¡"], ans: 2 },
            { q: "Jingle Bells é€™é¦–æ­ŒåŸæœ¬æ˜¯ç‚ºäº†ä»€éº¼ç¯€æ—¥å¯«çš„ï¼Ÿ", options: ["è–èª•ç¯€", "æ„Ÿæ©ç¯€", "å¾©æ´»ç¯€", "è¬è–ç¯€"], ans: 1 },
            { q: "è–èª•ç¯€çš„ä»£è¡¨è‰²é™¤äº†ç´…è‰²ï¼Œé€šå¸¸é‚„æœ‰ä»€éº¼é¡è‰²ï¼Ÿ", options: ["ç¶ è‰²", "ç´«è‰²", "é»‘è‰²", "ç²‰ç´…è‰²"], ans: 0 }
        ];

        // è¨­å®šçå‹µç´šè·
        const REWARDS = {
            TIER_1: { minScore: 400, code: "XMAS-SUPER-20", text: "ğŸŒŸ å°Šæ¦® 8 æŠ˜å„ªæƒ  ğŸŒŸ" },
            TIER_2: { minScore: 200, code: "XMAS-JOY-10", text: "âœ¨ æ­¡æ¨‚ 9 æŠ˜å„ªæƒ  âœ¨" },
            TIER_3: { minScore: 0,   code: "XMAS-NICE-05", text: "ğŸ æš–å¿ƒ 95 æŠ˜å„ªæƒ  ğŸ" }
        };

        // ç°¡å–®éŸ³æ•ˆåˆæˆå™¨ (ç„¡éœ€å¤–éƒ¨æª”æ¡ˆ)
        const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
        function playSound(type) {
            if (audioCtx.state === 'suspended') audioCtx.resume();
            const osc = audioCtx.createOscillator();
            const gain = audioCtx.createGain();
            osc.connect(gain);
            gain.connect(audioCtx.destination);
            
            if (type === 'correct') {
                // å®å’šè² (é«˜éŸ³)
                osc.type = 'sine';
                osc.frequency.setValueAtTime(600, audioCtx.currentTime);
                osc.frequency.exponentialRampToValueAtTime(1000, audioCtx.currentTime + 0.1);
                gain.gain.setValueAtTime(0.1, audioCtx.currentTime);
                gain.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.3);
                osc.start();
                osc.stop(audioCtx.currentTime + 0.3);
            } else {
                // éŒ¯èª¤è² (ä½éŸ³)
                osc.type = 'sawtooth';
                osc.frequency.setValueAtTime(200, audioCtx.currentTime);
                osc.frequency.linearRampToValueAtTime(100, audioCtx.currentTime + 0.3);
                gain.gain.setValueAtTime(0.1, audioCtx.currentTime);
                gain.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.3);
                osc.start();
                osc.stop(audioCtx.currentTime + 0.3);
            }
        }

        const game = {
            score: 0,
            currentQ: 0,
            timer: null,
            timeLeft: 10,
            maxTime: 10,
            questions: [], // å„²å­˜éš¨æ©ŸåŒ–å¾Œçš„é¡Œç›®
            
            start: function() {
                this.score = 0;
                this.currentQ = 0;
                // éš¨æ©Ÿé¸å– 5 é¡Œ
                this.questions = [...RAW_QUESTIONS].sort(() => 0.5 - Math.random()).slice(0, 5);
                
                document.getElementById('startScreen').classList.add('hidden');
                document.getElementById('gameScreen').classList.remove('hidden');
                this.loadQuestion();
            },

            loadQuestion: function() {
                if (this.currentQ >= this.questions.length) {
                    this.endGame();
                    return;
                }

                const qData = this.questions[this.currentQ];
                document.getElementById('qCount').innerText = `${this.currentQ + 1}/${this.questions.length}`;
                document.getElementById('questionText').innerText = qData.q;
                
                const container = document.getElementById('optionsContainer');
                container.innerHTML = '';

                qData.options.forEach((opt, idx) => {
                    const btn = document.createElement('button');
                    btn.className = 'btn option-btn';
                    btn.innerText = opt;
                    btn.onclick = () => this.checkAnswer(idx);
                    container.appendChild(btn);
                });

                // å•Ÿå‹•è¨ˆæ™‚
                this.startTimer();
            },

            startTimer: function() {
                this.timeLeft = this.maxTime;
                const bar = document.getElementById('timerBar');
                bar.style.transition = 'none';
                bar.style.width = '100%';
                
                // å¼·åˆ¶é‡ç¹ª
                void bar.offsetWidth;

                bar.style.transition = `width ${this.maxTime}s linear`;
                bar.style.width = '0%';

                if(this.timer) clearInterval(this.timer);
                
                this.timer = setInterval(() => {
                    this.timeLeft--;
                    if(this.timeLeft <= 0) {
                        this.checkAnswer(-1); // è¶…æ™‚
                    }
                }, 1000);
            },

            checkAnswer: function(selectedIndex) {
                clearInterval(this.timer);
                const correctIndex = this.questions[this.currentQ].ans;

                if (selectedIndex === correctIndex) {
                    // è¨ˆåˆ†: åŸºç¤åˆ† 50 + æ™‚é–“ç´…åˆ©
                    const points = 50 + (this.timeLeft * 10);
                    this.score += points;
                    this.flashFeedback(true);
                    playSound('correct');
                    
                    // è–èª•æ¨¹è·³å‹•ç‰¹æ•ˆ
                    const tree = document.getElementById('treeVisual');
                    tree.classList.remove('pulse-animation');
                    void tree.offsetWidth; // é‡ç¹ª
                    tree.classList.add('pulse-animation');

                } else {
                    this.flashFeedback(false);
                    playSound('wrong');
                }

                this.updateUI();
                
                // å»¶é²å¾Œä¸‹ä¸€é¡Œ
                setTimeout(() => {
                    this.currentQ++;
                    this.loadQuestion();
                }, 800);
            },

            flashFeedback: function(isCorrect) {
                const container = document.querySelector('.game-container');
                const originalBg = container.style.background;
                container.style.background = isCorrect ? 'rgba(46, 204, 113, 0.4)' : 'rgba(231, 76, 60, 0.4)';
                setTimeout(() => {
                    container.style.background = originalBg;
                }, 300);
            },

            updateUI: function() {
                // æ›´æ–°åˆ†æ•¸
                document.getElementById('scoreVal').innerText = this.score;

                // æ›´æ–°è–èª•æ¨¹äº®åº¦
                const tree = document.getElementById('treeVisual');
                // ç§»é™¤èˆŠç­‰ç´š
                tree.classList.remove('tree-level-1', 'tree-level-2', 'tree-level-3', 'tree-level-max');
                
                if (this.score > 400) tree.classList.add('tree-level-max');
                else if (this.score > 200) tree.classList.add('tree-level-3');
                else if (this.score > 100) tree.classList.add('tree-level-2');
                else if (this.score > 0) tree.classList.add('tree-level-1');
            },

            endGame: function() {
                document.getElementById('gameScreen').classList.add('hidden');
                document.getElementById('resultScreen').classList.remove('hidden');
                document.getElementById('finalScore').innerText = this.score;

                // åˆ¤æ–·çå‹µ
                let reward = REWARDS.TIER_3; 
                if (this.score >= REWARDS.TIER_1.minScore) reward = REWARDS.TIER_1;
                else if (this.score >= REWARDS.TIER_2.minScore) reward = REWARDS.TIER_2;

                document.getElementById('rewardTitle').innerText = reward.text;
                document.getElementById('codeDisplay').innerText = reward.code;
                
                // çµç®—éŸ³æ•ˆ
                if (this.score >= 200) {
                    setTimeout(() => playSound('correct'), 200);
                    setTimeout(() => playSound('correct'), 400);
                }
            },

            copyCode: function() {
                const code = document.getElementById('codeDisplay').innerText;
                navigator.clipboard.writeText(code).then(() => {
                    alert('âœ… å·²è¤‡è£½æŠ˜æ‰£ç¢¼ï¼š' + code);
                });
            }
        };
    </script>
</body>
</html>
