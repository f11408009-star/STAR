<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ğŸ„ è–èª•é»ç‡ˆæŒ‘æˆ°è³½ - åˆ†æ•¸è¶Šé«˜æŠ˜æ‰£è¶Šå¤šï¼</title>
    <style>
        :root {
            --bg-color: #0F2027;
            --primary-red: #D42E2E;
            --primary-green: #2F5D62;
            --gold: #FFD700;
            --text-white: #ffffff;
        }

        body {
            font-family: 'Segoe UI', 'Microsoft JhengHei', sans-serif;
            background: radial-gradient(circle at center, #203A43, #0F2027);
            color: var(--text-white);
            margin: 0;
            height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            overflow: hidden;
            position: relative;
        }

        /* é›ªèŠ±èƒŒæ™¯å‹•ç•« */
        .snow {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 0;
            background-image: url('data:image/svg+xml;utf8,<svg version="1.1" xmlns="http://www.w3.org/2000/svg" width="20" height="20"><circle cx="10" cy="10" r="2" fill="white" opacity="0.3"/></svg>');
            animation: snow-fall 20s linear infinite;
        }

        @keyframes snow-fall {
            from { background-position: 0 0; }
            to { background-position: 0 500px; }
        }

        /* éŠæˆ²å®¹å™¨ */
        .game-container {
            width: 90%;
            max-width: 450px;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 20px;
            box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.37);
            border: 1px solid rgba(255, 255, 255, 0.18);
            z-index: 10;
            text-align: center;
            position: relative;
            transition: height 0.3s ease;
        }

        /* è–èª•æ¨¹è¦–è¦º */
        .tree-wrapper {
            position: relative;
            width: 120px;
            height: 160px;
            margin: 0 auto 20px;
            transition: filter 0.5s ease;
            filter: brightness(0.4) grayscale(0.8); /* åˆå§‹æš—æ·¡ */
        }
        
        .tree-svg {
            width: 100%;
            height: 100%;
        }

        /* ç‡ˆå…‰ç­‰ç´š */
        .tree-level-1 { filter: brightness(0.6) grayscale(0.5); }
        .tree-level-2 { filter: brightness(0.8) grayscale(0.2); }
        .tree-level-3 { filter: brightness(1.0) grayscale(0) drop-shadow(0 0 10px gold); }
        .tree-level-max { filter: brightness(1.2) saturate(1.2) drop-shadow(0 0 20px gold); animation: glow 1.5s infinite alternate; }

        @keyframes glow {
            from { filter: brightness(1.2) drop-shadow(0 0 15px gold); }
            to { filter: brightness(1.4) drop-shadow(0 0 30px gold); }
        }

        /* ä»‹é¢å…ƒç´  */
        h1, h2 { margin: 10px 0; text-shadow: 0 2px 4px rgba(0,0,0,0.5); }
        
        .btn {
            background: var(--primary-red);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 50px;
            font-size: 1.1rem;
            cursor: pointer;
            transition: transform 0.2s, background 0.2s;
            width: 80%;
            margin: 10px auto;
            display: block;
            box-shadow: 0 4px 6px rgba(0,0,0,0.2);
        }

        .btn:active { transform: scale(0.95); }
        .btn:hover { background: #ff4747; }
        
        .option-btn {
            background: rgba(255,255,255,0.1);
            border: 1px solid rgba(255,255,255,0.3);
            text-align: left;
            padding: 15px;
            margin: 8px 0;
            width: 100%;
            border-radius: 10px;
        }

        /* ç‹€æ…‹é¡¯ç¤º */
        .status-bar {
            display: flex;
            justify-content: space-between;
            margin-bottom: 15px;
            font-size: 0.9rem;
            color: #ccc;
        }
        .score-display { color: var(--gold); font-weight: bold; font-size: 1.2rem; }

        /* è¨ˆæ™‚æ¢ */
        .timer-bar {
            width: 100%;
            height: 6px;
            background: rgba(255,255,255,0.2);
            border-radius: 3px;
            margin-bottom: 20px;
            overflow: hidden;
        }
        .timer-fill {
            height: 100%;
            background: var(--gold);
            width: 100%;
            transition: width 1s linear;
        }

        /* çµæœé æŠ˜æ‰£ç¢¼ */
        .coupon-card {
            background: white;
            color: #333;
            padding: 20px;
            border-radius: 10px;
            margin-top: 20px;
            position: relative;
            overflow: hidden;
        }
        .coupon-card::before {
            content: '';
            position: absolute;
            top: 0; left: 0; width: 100%; height: 5px;
            background: linear-gradient(90deg, var(--primary-red), var(--primary-green));
        }
        .discount-code {
            font-size: 2rem;
            font-weight: 800;
            color: var(--primary-red);
            border: 2px dashed #ccc;
            padding: 10px;
            margin: 10px 0;
            cursor: pointer;
        }
        .discount-desc { font-size: 0.9rem; color: #666; }

        /* éš±è— */
        .hidden { display: none !important; }

    </style>
</head>
<body>

    <div class="snow"></div>

    <div class="game-container">
        
        <!-- è–èª•æ¨¹ (SVG) -->
        <div class="tree-wrapper" id="treeVisual">
            <svg class="tree-svg" viewBox="0 0 100 130">
                <!-- æ¨¹å¹¹ -->
                <rect x="45" y="110" width="10" height="20" fill="#5D4037" />
                <!-- æ¨¹è‘‰ -->
                <path d="M50 20 L20 60 L80 60 Z" fill="#2E7D32" />
                <path d="M50 40 L15 90 L85 90 Z" fill="#2E7D32" />
                <path d="M50 60 L10 110 L90 110 Z" fill="#388E3C" />
                <!-- æ˜Ÿæ˜Ÿ -->
                <path d="M50 5 L53 15 L63 15 L55 22 L58 32 L50 26 L42 32 L45 22 L37 15 L47 15 Z" fill="#FFD700" />
                <!-- è£é£¾çƒ (åˆå§‹çœ‹ä¸è¦‹ï¼Œé CSSæ§åˆ¶äº®åº¦) -->
                <circle cx="30" cy="70" r="3" fill="red" />
                <circle cx="70" cy="80" r="3" fill="gold" />
                <circle cx="50" cy="50" r="3" fill="cyan" />
                <circle cx="40" cy="100" r="3" fill="orange" />
                <circle cx="60" cy="95" r="3" fill="white" />
            </svg>
        </div>

        <!-- 1. é–‹å§‹ç•«é¢ -->
        <div id="startScreen">
            <h1>ğŸ… è–èª•æ¶åˆ†è³½</h1>
            <p>å›ç­”è¶Šå¿«ï¼Œåˆ†æ•¸è¶Šé«˜ï¼ŒæŠ˜æ‰£è¶Šå¤šï¼</p>
            <div style="font-size: 0.8rem; margin: 20px 0; color: #ddd;">
                <p>ğŸ† 400åˆ†ä»¥ä¸Šï¼š<strong>8 æŠ˜</strong></p>
                <p>ğŸ¥ˆ 200åˆ†ä»¥ä¸Šï¼š<strong>9 æŠ˜</strong></p>
                <p>ğŸ¥‰ åƒåŠ çï¼š<strong>95 æŠ˜</strong></p>
            </div>
            <button class="btn" onclick="game.start()">é–‹å§‹æŒ‘æˆ°</button>
        </div>

        <!-- 2. éŠæˆ²ç•«é¢ -->
        <div id="gameScreen" class="hidden">
            <div class="status-bar">
                <span>é¡Œç›®: <span id="qCount">1/5</span></span>
                <span>åˆ†æ•¸: <span id="scoreVal" class="score-display">0</span></span>
            </div>
            <div class="timer-bar"><div class="timer-fill" id="timerBar"></div></div>
            
            <h3 id="questionText" style="min-height: 60px;">é¡Œç›®è¼‰å…¥ä¸­...</h3>
            <div id="optionsContainer">
                <!-- é¸é …æŒ‰éˆ• -->
            </div>
        </div>

        <!-- 3. çµç®—ç•«é¢ -->
        <div id="resultScreen" class="hidden">
            <h2>ğŸ‰ æŒ‘æˆ°çµæŸï¼</h2>
            <p>ä½ çš„ç¸½åˆ†æ˜¯ï¼š<span id="finalScore" class="score-display">0</span></p>
            
            <div class="coupon-card">
                <div id="rewardTitle">æ­å–œç²å¾—æŠ˜æ‰£ç¢¼</div>
                <div class="discount-code" id="codeDisplay" onclick="game.copyCode()">Loading...</div>
                <p class="discount-desc">é»æ“Šä¸Šæ–¹ä»£ç¢¼è¤‡è£½ï¼Œçµå¸³æ™‚ä½¿ç”¨</p>
            </div>

            <button class="btn" onclick="location.reload()" style="margin-top:20px; background:#555;">å†ç©ä¸€æ¬¡åˆ·é«˜åˆ†</button>
        </div>

    </div>

    <script>
        const QUESTIONS = [
            { q: "è–èª•è€äººçš„é›ªæ©‡æ˜¯ç”±ä»€éº¼å‹•ç‰©æ‹‰çš„ï¼Ÿ", options: ["å“ˆå£«å¥‡", "é¦´é¹¿", "åŒ—æ¥µç†Š", "è¢‹é¼ "], ans: 1 },
            { q: "å‚³çµ±è–èª•æ¨¹é ‚ç«¯é€šå¸¸æœƒæ”¾ä»€éº¼ï¼Ÿ", options: ["æ˜Ÿæ˜Ÿ", "å—ç“œ", "è¥ªå­", "ç”œç”œåœˆ"], ans: 0 },
            { q: "è–èª•ç¯€æ˜¯ç‚ºäº†æ…¶ç¥èª°çš„èª•ç”Ÿï¼Ÿ", options: ["è–èª•è€äºº", "è€¶ç©Œ", "è¯ç››é “", "éº‹é¹¿é­¯é“å¤«"], ans: 1 },
            { q: "çŸ¥åçš„ç´…é¼»å­é¦´é¹¿å«ä»€éº¼åå­—ï¼Ÿ", options: ["æ¹¯å§†", "å‚‘åˆ©", "é­¯é“å¤«", "å²åŠªæ¯”"], ans: 2 },
            { q: "è–èª•è€äººé€šå¸¸å¾å“ªè£¡é€²å…¥æˆ¿å­é€ç¦®ç‰©ï¼Ÿ", options: ["å¤§é–€", "çª—æˆ¶", "ç…™å›ª", "æ’æ°´ç®¡"], ans: 2 }
        ];

        // è¨­å®šçå‹µç´šè·
        const REWARDS = {
            TIER_1: { minScore: 400, code: "XMAS-SUPER-20", text: "å°Šæ¦® 8 æŠ˜å„ªæƒ " },
            TIER_2: { minScore: 200, code: "XMAS-JOY-10", text: "æ­¡æ¨‚ 9 æŠ˜å„ªæƒ " },
            TIER_3: { minScore: 0,   code: "XMAS-NICE-05", text: "æš–å¿ƒ 95 æŠ˜å„ªæƒ " }
        };

        const game = {
            score: 0,
            currentQ: 0,
            timer: null,
            timeLeft: 10, // æ¯é¡Œå¹¾ç§’
            maxTime: 10,
            
            start: function() {
                this.score = 0;
                this.currentQ = 0;
                document.getElementById('startScreen').classList.add('hidden');
                document.getElementById('gameScreen').classList.remove('hidden');
                this.loadQuestion();
            },

            loadQuestion: function() {
                if (this.currentQ >= QUESTIONS.length) {
                    this.endGame();
                    return;
                }

                const qData = QUESTIONS[this.currentQ];
                document.getElementById('qCount').innerText = `${this.currentQ + 1}/${QUESTIONS.length}`;
                document.getElementById('questionText').innerText = qData.q;
                
                const container = document.getElementById('optionsContainer');
                container.innerHTML = '';

                qData.options.forEach((opt, idx) => {
                    const btn = document.createElement('button');
                    btn.className = 'btn option-btn';
                    btn.innerText = opt;
                    btn.onclick = () => this.checkAnswer(idx);
                    container.appendChild(btn);
                });

                // é‡ç½®ä¸¦å•Ÿå‹•è¨ˆæ™‚å™¨
                this.startTimer();
            },

            startTimer: function() {
                this.timeLeft = this.maxTime;
                const bar = document.getElementById('timerBar');
                bar.style.transition = 'none';
                bar.style.width = '100%';
                
                // å¼·åˆ¶é‡ç¹ª
                void bar.offsetWidth;

                bar.style.transition = `width ${this.maxTime}s linear`;
                bar.style.width = '0%';

                if(this.timer) clearInterval(this.timer);
                
                this.timer = setInterval(() => {
                    this.timeLeft--;
                    if(this.timeLeft <= 0) {
                        this.checkAnswer(-1); // æ™‚é–“åˆ°ï¼Œå‚³å…¥éŒ¯èª¤ç´¢å¼•
                    }
                }, 1000);
            },

            checkAnswer: function(selectedIndex) {
                clearInterval(this.timer);
                const correctIndex = QUESTIONS[this.currentQ].ans;

                if (selectedIndex === correctIndex) {
                    // è¨ˆç®—åˆ†æ•¸ï¼šåŸºç¤åˆ† 50 + æ™‚é–“åŠ æˆ (å‰©é¤˜ç§’æ•¸ * 10)
                    // æœ€é«˜åˆ†æ¯é¡Œç´„ 150 åˆ†
                    const points = 50 + (this.timeLeft * 10);
                    this.score += points;
                    this.flashFeedback(true);
                } else {
                    this.flashFeedback(false);
                }

                this.updateUI();
                
                // å»¶é²å¾Œé€²å…¥ä¸‹ä¸€é¡Œ
                setTimeout(() => {
                    this.currentQ++;
                    this.loadQuestion();
                }, 800);
            },

            flashFeedback: function(isCorrect) {
                const container = document.querySelector('.game-container');
                const originalBg = container.style.background;
                container.style.background = isCorrect ? 'rgba(46, 204, 113, 0.3)' : 'rgba(231, 76, 60, 0.3)';
                setTimeout(() => {
                    container.style.background = originalBg;
                }, 300);
            },

            updateUI: function() {
                // æ›´æ–°åˆ†æ•¸é¡¯ç¤º
                const scoreEl = document.getElementById('scoreVal');
                scoreEl.innerText = this.score;

                // æ›´æ–°è–èª•æ¨¹äº®åº¦ (æ ¹æ“šåˆ†æ•¸ç™¾åˆ†æ¯”)
                // å‡è¨­æ»¿åˆ†å¤§ç´„æ˜¯ 750 åˆ†
                const tree = document.getElementById('treeVisual');
                tree.className = 'tree-wrapper'; // é‡ç½®
                
                if (this.score > 400) tree.classList.add('tree-level-max');
                else if (this.score > 200) tree.classList.add('tree-level-3');
                else if (this.score > 100) tree.classList.add('tree-level-2');
                else if (this.score > 0) tree.classList.add('tree-level-1');
            },

            endGame: function() {
                document.getElementById('gameScreen').classList.add('hidden');
                document.getElementById('resultScreen').classList.remove('hidden');
                document.getElementById('finalScore').innerText = this.score;

                // æ±ºå®šçå‹µ
                let reward = REWARDS.TIER_3; // é è¨­æœ€ä½
                if (this.score >= REWARDS.TIER_1.minScore) reward = REWARDS.TIER_1;
                else if (this.score >= REWARDS.TIER_2.minScore) reward = REWARDS.TIER_2;

                document.getElementById('rewardTitle').innerText = reward.text;
                document.getElementById('codeDisplay').innerText = reward.code;
            },

            copyCode: function() {
                const code = document.getElementById('codeDisplay').innerText;
                navigator.clipboard.writeText(code).then(() => {
                    alert('å·²è¤‡è£½æŠ˜æ‰£ç¢¼ï¼š' + code);
                });
            }
        };
    </script>
</body>
</html>
